<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 검색어 순위</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
        .list-transition { transition: all 0.3s ease-in-out; }
        .icon-transition { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400">실시간 검색어 순위</h1>
            <p id="update-time" class="text-gray-400 mt-2">{{ last_updated }}</p>
        </header>

        <main class="bg-gray-800 rounded-2xl shadow-2xl shadow-cyan-500/10 overflow-hidden">
            <ul id="top-10-list" class="divide-y divide-gray-700">
                <!-- 자바스크립트가 이 부분을 채울 것입니다. -->
            </ul>
            <div id="rest-of-list-container" class="list-transition max-h-0 overflow-hidden">
                <ul id="rest-of-list" class="divide-y divide-gray-700 border-t border-gray-700">
                    <!-- 자바스크립트가 이 부분을 채울 것입니다. -->
                </ul>
            </div>
            
            <div id="expand-button" class="bg-gray-700/50 hover:bg-gray-700 text-center p-4 cursor-pointer transition-colors duration-200">
                <div class="flex items-center justify-center text-cyan-400">
                    <span id="expand-text" class="font-semibold">더보기</span>
                    <svg id="expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-2 icon-transition" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>
        </main>
    </div>

    <script>
        const top10List = document.getElementById('top-10-list');
        const restOfList = document.getElementById('rest-of-list');
        const updateTimeElement = document.getElementById('update-time');

        // 순위 변동 HTML을 생성하는 함수
        function createRankChangeHTML(rankChangeString) {
            if (rankChangeString === 'new') {
                return `<span class="text-sm font-bold text-green-400">New</span>`;
            }

            const [direction, value] = rankChangeString.split('_');
            const changeValue = parseInt(value, 10);

            if (direction === 'up') {
                return `
                    <div class="flex items-center space-x-1 text-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd" />
                        </svg>
                        <span class="font-semibold text-xs">${changeValue}</span>
                    </div>
                `;
            } else if (direction === 'down') {
                return `
                    <div class="flex items-center space-x-1 text-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-3.707-9.293l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414z" clip-rule="evenodd" />
                        </svg>
                        <span class="font-semibold text-xs">${changeValue}</span>
                    </div>
                `;
            } else { // 'same'
                return `
                    <div class="flex items-center text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4" />
                        </svg>
                    </div>
                `;
            }
        }

        // 순위 항목 HTML을 생성하는 함수
        function createRankItem(item, index, isTop10 = true) {
            const rankColor = isTop10 ? 'text-cyan-400' : 'text-gray-500';
            const keywordColor = isTop10 ? 'text-gray-200' : 'text-gray-300';
            const rankChangeHTML = createRankChangeHTML(item.rank_change);

            return `
                <li class="transition-colors duration-200 hover:bg-gray-700/50">
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="p-4 flex items-center justify-between">
                        <div class="flex items-center min-w-0">
                            <span class="text-lg font-bold ${rankColor} w-8 text-center flex-shrink-0">${index}</span>
                            <span class="ml-4 text-lg font-medium ${keywordColor} truncate">${item.keyword}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${rankChangeHTML}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </div>
                    </a>
                </li>
            `;
        }

        // 서버에서 최신 순위 데이터를 가져와 화면을 업데이트하는 함수
        async function updateRankings() {
            try {
                const response = await fetch('/api/trends');
                const data = await response.json();

                top10List.innerHTML = '';
                restOfList.innerHTML = '';

                const rankings = data.rankings || [];
                rankings.slice(0, 10).forEach((item, i) => {
                    top10List.innerHTML += createRankItem(item, i + 1, true);
                });
                rankings.slice(10).forEach((item, i) => {
                    restOfList.innerHTML += createRankItem(item, i + 11, false);
                });
                
                if (data.last_updated) {
                    updateTimeElement.textContent = data.last_updated;
                }

                console.log('순위가 자동으로 업데이트되었습니다.');
            } catch (error) {
                console.error('순위 업데이트 중 오류 발생:', error);
            }
        }

        // --- 더보기 버튼 로직 (이전과 동일) ---
        const expandButton = document.getElementById('expand-button');
        const restOfListContainer = document.getElementById('rest-of-list-container');
        const expandIcon = document.getElementById('expand-icon');
        const expandText = document.getElementById('expand-text');
        let isExpanded = false;

        expandButton.addEventListener('click', () => {
            isExpanded = !isExpanded;
            if (isExpanded) {
                restOfListContainer.style.maxHeight = `${restOfListContainer.scrollHeight}px`;
                expandIcon.style.transform = 'rotate(180deg)';
                expandText.textContent = '접기';
            } else {
                restOfListContainer.style.maxHeight = '0px';
                expandIcon.style.transform = 'rotate(0deg)';
                expandText.textContent = '더보기';
            }
        });

        // --- 자동 업데이트 실행 ---
        updateRankings();
        // 1분(60,000 밀리초)마다 주기적으로 서버에 최신 데이터를 요청하도록 수정
        setInterval(updateRankings, 60000);
    </script>
</body>
</html>